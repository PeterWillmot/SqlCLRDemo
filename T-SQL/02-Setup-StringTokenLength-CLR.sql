USE master
GO

EXEC sp_configure 'show advanced options', 1
EXEC sp_configure 'clr enabled', 1
--EXEC sp_configure 'clr strict security', 0
RECONFIGURE

USE Demo
GO

IF EXISTS (SELECT 1 FROM sys.objects WHERE name = 'GetFastTokenLength') DROP FUNCTION dbo.GetFastTokenLength
IF EXISTS(SELECT 1 FROM sys.assemblies WHERE name = 'SqlClassLibrary') DROP ASSEMBLY SqlClassLibrary

GO
CREATE ASSEMBLY [SqlClassLibrary]
    AUTHORIZATION [dbo]
    FROM 0x4D5A90000300000004000000FFFF0000B800000000000000400000000000000000000000000000000000000000000000000000000000000000000000800000000E1FBA0E00B409CD21B8014CCD21546869732070726F6772616D2063616E6E6F742062652072756E20696E20444F53206D6F64652E0D0D0A2400000000000000504500004C010300676A155D0000000000000000E00022200B01300000080000000600000000000032270000002000000040000000000010002000000002000004000000000000000600000000000000008000000002000000000000030060850000100000100000000010000010000000000000100000000000000000000000E02600004F00000000400000D803000000000000000000000000000000000000006000000C00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000080000000000000000000000082000004800000000000000000000002E7465787400000038070000002000000008000000020000000000000000000000000000200000602E72737263000000D80300000040000000040000000A0000000000000000000000000000400000402E72656C6F6300000C0000000060000000020000000E00000000000000000000000000004000004200000000000000000000000000000000142700000000000048000000020005009820000048060000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000013300500310000000100001102280D00000A2D270416322302178D110000012516039D6F0E00000A0A062C0F068E6904310906049A6F0F00000A2A152A1E02281000000A2A00000042534A4201000100000000000C00000076342E302E33303331390000000005006C000000E4010000237E0000500200009C02000023537472696E677300000000EC0400000400000023555300F0040000100000002347554944000000000500004801000023426C6F620000000000000002000001471502000900000000FA0133001600000100000011000000020000000200000003000000100000000C000000010000000100000002000000000096010100000000000600D900250206004601250206002E00F3010F004502000006005600B1010600BC00B10106008800B10106002D01B1010600F900B10106001201B10106006D00B10106004200060206006902AA010A00A700D2010A001F00D20106006401AA010600C301AA010000000001000000000001000100010010005402000035000100010050200000000096007601380001008D20000000008618ED010600040000000100760200000200C8010000030089010900ED0101001100ED0106001900ED010A002900ED0110003100ED0110003900ED0110004100ED0110004900ED0110005100ED0110005900ED0110006100ED0115007100ED01060081008B021F0081007002240081006B012B006900ED01060020006300B5002E000B003F002E00130048002E001B0067002E00230070002E002B007F002E0033007F002E003B0085002E00430070002E004B0094002E0053007F002E005B007F001A000480000001000000CE1BFB0F0000000000007B0200000400000000000000000000002F001600000000000400000000000000000000002F000A00000000000000003C4D6F64756C653E0053797374656D2E44617461006D73636F726C696200446174614163636573734B696E640044656275676761626C6541747472696275746500436F6D56697369626C6541747472696275746500417373656D626C795469746C6541747472696275746500417373656D626C7954726164656D61726B41747472696275746500417373656D626C79436F6E66696775726174696F6E4174747269627574650053716C46756E6374696F6E41747472696275746500417373656D626C794465736372697074696F6E41747472696275746500436F6D70696C6174696F6E52656C61786174696F6E7341747472696275746500417373656D626C7950726F6475637441747472696275746500417373656D626C79436F7079726967687441747472696275746500417373656D626C79436F6D70616E794174747269627574650052756E74696D65436F6D7061746962696C69747941747472696275746500537472696E67006765745F4C656E6774680047657446617374546F6B656E4C656E67746800746F6B656E4F7264696E616C0053716C436C6173734C6962726172792E646C6C0053797374656D0053797374656D2E5265666C656374696F6E00436861720064656C696D69746572004D6963726F736F66742E53716C5365727665722E536572766572002E63746F720053797374656D2E446961676E6F73746963730053797374656D2E52756E74696D652E496E7465726F7053657276696365730053797374656D2E52756E74696D652E436F6D70696C6572536572766963657300446562756767696E674D6F6465730055736572446566696E656446756E6374696F6E73004F626A6563740053706C6974006C6973740053716C436C6173734C6962726172790049734E756C6C4F72456D70747900000000000000003A06A787905B574983EF51D381E1661E00042001010803200001052001011111042001010E04200101020407011D0E040001020E0620011D0E1D030320000808B77A5C561934E089060003080E03080801000800000000001E01000100540216577261704E6F6E457863657074696F6E5468726F7773010801000200000000000E010009434C5253616D706C6500000501000000000E0100094D6963726F736F667400002001001B436F7079726967687420C2A9204D6963726F736F667420323031300000808F010001005455794D6963726F736F66742E53716C5365727665722E5365727665722E446174614163636573734B696E642C2053797374656D2E446174612C2056657273696F6E3D342E302E302E302C2043756C747572653D6E65757472616C2C205075626C69634B6579546F6B656E3D623737613563353631393334653038390A446174614163636573730000000000000827000000000000000000002227000000200000000000000000000000000000000000000000000014270000000000000000000000005F436F72446C6C4D61696E006D73636F7265652E646C6C0000000000FF25002000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001001000000018000080000000000000000000000000000001000100000030000080000000000000000000000000000001000000000048000000584000007C03000000000000000000007C0334000000560053005F00560045005200530049004F004E005F0049004E0046004F0000000000BD04EFFE0000010000000100FB0FCE1B00000100FB0FCE1B3F000000000000000400000002000000000000000000000000000000440000000100560061007200460069006C00650049006E0066006F00000000002400040000005400720061006E0073006C006100740069006F006E00000000000000B004DC020000010053007400720069006E006700460069006C00650049006E0066006F000000B802000001003000300030003000300034006200300000001A000100010043006F006D006D0065006E007400730000000000000034000A00010043006F006D00700061006E0079004E0061006D006500000000004D006900630072006F0073006F006600740000003C000A000100460069006C0065004400650073006300720069007000740069006F006E000000000043004C005200530061006D0070006C00650000003C000E000100460069006C006500560065007200730069006F006E000000000031002E0030002E0037003100310038002E003400300039003100000048001400010049006E007400650072006E0061006C004E0061006D0065000000530071006C0043006C006100730073004C006900620072006100720079002E0064006C006C0000005A001B0001004C006500670061006C0043006F007000790072006900670068007400000043006F0070007900720069006700680074002000A90020004D006900630072006F0073006F006600740020003200300031003000000000002A00010001004C006500670061006C00540072006100640065006D00610072006B00730000000000000000005000140001004F0072006900670069006E0061006C00460069006C0065006E0061006D0065000000530071006C0043006C006100730073004C006900620072006100720079002E0064006C006C00000034000A000100500072006F0064007500630074004E0061006D0065000000000043004C005200530061006D0070006C006500000040000E000100500072006F006400750063007400560065007200730069006F006E00000031002E0030002E0037003100310038002E003400300039003100000044000E00010041007300730065006D0062006C0079002000560065007200730069006F006E00000031002E0030002E0037003100310038002E00340030003900310000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000000C000000343700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000;


GO
PRINT N'Creating [dbo].[GetFastTokenLength]...';


GO
CREATE FUNCTION [dbo].[GetFastTokenLength]
(@list NVARCHAR (MAX) NULL, @delimiter NCHAR (1) NULL, @tokenOrdinal INT NULL)
RETURNS INT
AS
 EXTERNAL NAME [SqlClassLibrary].[UserDefinedFunctions].[GetFastTokenLength]
